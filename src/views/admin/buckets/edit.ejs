<%- include('../../partials/header', { title: bucket ? 'Edit Unit/Sectional' : 'New Unit/Sectional', backLink: '/admin/unions/' + union.id }) %>

<div class="form-container">
  <h2><%= bucket ? 'Edit Unit/Sectional' : 'New Unit/Sectional' %></h2>
  <p class="text-muted">Union: <%= union.name %></p>

  <form action="/admin/unions/<%= union.id %>/buckets<%= bucket ? '/' + bucket.id : '' %>" method="POST" enctype="multipart/form-data">
    <div class="form-group">
      <label for="number">Unit/Sectional Number</label>
      <input type="text" id="number" name="number" value="<%= bucket ? bucket.number : '' %>" required>
      <small>A unique identifier for this unit/sectional (e.g., "1", "A", "North")</small>
    </div>

    <div class="form-group">
      <label for="name">Unit/Sectional Name</label>
      <input type="text" id="name" name="name" value="<%= bucket ? bucket.name : '' %>" required>
      <small>A descriptive name for this unit/sectional</small>
    </div>

    <% if (!bucket) { %>
      <hr class="form-divider">
      <h3>Master PDF Document</h3>
      <p class="text-muted">Upload a PDF document that will be emailed to members not in good standing. (Optional - can be added later)</p>
      <div class="form-group">
        <label for="master_pdf">Upload PDF (optional)</label>
        <input type="file" id="master_pdf" name="master_pdf" accept=".pdf">
      </div>
    <% } %>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary"><%= bucket ? 'Update Unit/Sectional' : 'Create Unit/Sectional' %></button>
      <a href="/admin/unions/<%= union.id %>" class="btn btn-outline">Cancel</a>
    </div>
  </form>

  <% if (bucket) { %>
    <hr class="form-divider">

    <h3>Master PDF Document</h3>
    <p class="text-muted">Upload a PDF document that will be emailed to members not in good standing.</p>

    <% if (bucket.master_pdf_filename) { %>
      <div class="pdf-info">
        <span class="pdf-badge">PDF Uploaded</span>
        <div class="pdf-actions">
          <a href="/admin/unions/<%= union.id %>/buckets/<%= bucket.id %>/master-pdf" class="btn btn-outline btn-sm">Download</a>
          <form action="/admin/unions/<%= union.id %>/buckets/<%= bucket.id %>/remove-master-pdf" method="POST" class="inline-form" onsubmit="return confirm('Remove this master PDF?')">
            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
          </form>
        </div>
      </div>
    <% } %>

    <form action="/admin/unions/<%= union.id %>/buckets/<%= bucket.id %>/upload-master-pdf" method="POST" enctype="multipart/form-data" class="upload-form">
      <div class="form-group">
        <label for="master_pdf"><%= bucket.master_pdf_filename ? 'Replace PDF' : 'Upload PDF' %></label>
        <input type="file" id="master_pdf" name="master_pdf" accept=".pdf" required>
      </div>
      <button type="submit" class="btn btn-primary btn-sm">Upload PDF</button>
    </form>
  <% } %>
</div>

<style>
.pdf-info {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: var(--radius);
  margin-bottom: 1rem;
}
.pdf-badge {
  background: var(--success);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 500;
}
.pdf-actions {
  display: flex;
  gap: 0.5rem;
  margin-left: auto;
}
.upload-form {
  display: flex;
  gap: 1rem;
  align-items: flex-end;
}
.upload-form .form-group {
  flex: 1;
  margin-bottom: 0;
}
</style>
