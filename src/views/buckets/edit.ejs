<%- include('../partials/header', {
  title: bucket ? 'Edit Bucket' : 'Create Bucket',
  backLink: '/dashboard'
}) %>

<div class="form-container">
  <form action="<%= bucket ? '/buckets/' + bucket.id : '/buckets' %>" method="POST">
    <div class="form-row">
      <div class="form-group" style="flex: 0 0 120px;">
        <label for="number">Number</label>
        <input type="text" id="number" name="number" value="<%= bucket ? bucket.number : '' %>" required placeholder="e.g., 1">
      </div>
      <div class="form-group" style="flex: 1;">
        <label for="name">Name</label>
        <input type="text" id="name" name="name" value="<%= bucket ? bucket.name : '' %>" required autofocus placeholder="e.g., Active Members">
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary"><%= bucket ? 'Update' : 'Create' %> Bucket</button>
      <a href="/dashboard" class="btn btn-outline">Cancel</a>
    </div>
  </form>

  <% if (bucket) { %>
    <hr class="form-divider">

    <h3>Master PDF Document</h3>
    <p class="text-muted">Upload a PDF document that will be emailed to members not in good standing.</p>

    <% if (bucket.master_pdf_filename) { %>
      <div class="pdf-info">
        <span class="pdf-badge">PDF Uploaded</span>
        <div class="pdf-actions">
          <a href="/buckets/<%= bucket.id %>/master-pdf" class="btn btn-outline btn-sm">Download</a>
          <form action="/buckets/<%= bucket.id %>/remove-master-pdf" method="POST" class="inline-form" onsubmit="return confirm('Remove this master PDF?')">
            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
          </form>
        </div>
      </div>
    <% } %>

    <form action="/buckets/<%= bucket.id %>/upload-master-pdf" method="POST" enctype="multipart/form-data" class="upload-form">
      <div class="form-group">
        <label for="master_pdf"><%= bucket.master_pdf_filename ? 'Replace PDF' : 'Upload PDF' %></label>
        <input type="file" id="master_pdf" name="master_pdf" accept=".pdf" required>
      </div>
      <button type="submit" class="btn btn-primary btn-sm">Upload PDF</button>
    </form>

    <hr class="form-divider">

    <h3>Danger Zone</h3>
    <p class="text-muted">Deleting this bucket will hide it from view. Contact admin to recover if needed.</p>
    <button type="button" class="btn btn-danger" onclick="openDeleteModal('/buckets/<%= bucket.id %>/delete', '<%= bucket.name %>', <%= typeof memberCount !== 'undefined' ? memberCount : 0 %>)">Delete Bucket</button>
  <% } %>
</div>

<style>
.pdf-info {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: var(--radius);
  margin-bottom: 1rem;
}
.pdf-badge {
  background: var(--success);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 500;
}
.pdf-actions {
  display: flex;
  gap: 0.5rem;
  margin-left: auto;
}
.upload-form {
  display: flex;
  gap: 1rem;
  align-items: flex-end;
}
.upload-form .form-group {
  flex: 1;
  margin-bottom: 0;
}
</style>

<%- include('../partials/delete-modal') %>
